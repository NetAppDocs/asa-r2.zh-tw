---
sidebar: sidebar 
permalink: data-protection/manage-consistency-groups.html 
keywords: consistency groups, snapshots, data protection, protect data, add, remove, delete, storage units, lun, namespace, increase capacity 
summary: 使用一致性群組同時對多個儲存單元執行各種動作、而非在每個單元上個別執行動作。 
---
= 在 ASA R2 儲存系統上管理 ONTAP 一致性群組
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
一致性群組是以單一單元管理的儲存單元集合。使用一致性群組來簡化儲存管理。例如，假設您的資料庫由一致性群組中的 10 個儲存單元組成，而您需要備份整個資料庫。您只需將快照資料保護新增至一致性群組、即可備份整個資料庫、而無需備份每個儲存單元。將儲存單元備份為一致性群組、而非個別備份、也能為所有單元提供一致的備份、而個別備份單元則可能會造成不一致的情況。

從 ONTAP 9.16.1 開始，您可以使用系統管理員在 ASA R2 系統上建立階層式一致性群組。在階層式結構中，一個或多個一致性群組會設定為父一致性群組下的子群組。

階層式一致性群組可讓您將個別的快照原則套用到每個子一致性群組，並透過複寫父叢集，將所有子一致性群組的快照複寫到單一單元的遠端叢集。如此可簡化複雜資料結構的資料保護與管理。例如，假設您建立一個父一致性群組，稱為 `SVM1_app`，其中包含兩個子一致性群組： `SVM1app_data`應用程式資料和 `SVM1app_logs`應用程式記錄。每 15 分鐘拍攝一次的快照 `SVM1app_data`，每小時拍攝一次的快照 `SVM1app_logs`。父一致性群組具有 SnapMirror 原則， `SVM1_app,`可每 24 小時將和 `SVM1app_logs`的快照複寫 `SVM1app_data`到遠端叢集。父一致性群組 `SVM1_app`是以單一單位來管理，子一致性群組則以個別單位來管理。



== 將 Snapshot 資料保護新增至一致性群組

將快照資料保護新增至一致性群組時、會根據預先定義的排程、定期擷取一致性群組的本機快照。

您可以使用link:restore-data.html["還原資料"]遺失或毀損的快照。

.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 將游標移到您要保護的一致性群組上。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 編輯 * 。
. 在 * 本機保護 * 下、選取 * 排程快照 * 。
. 選取快照原則。
+
接受預設的快照原則、選取現有原則、或建立新原則。

+
[cols="2,6a"]
|===
| 選項 | 步驟 


| 選取現有的快照原則  a| 
選取image:icon_dropdown_arrow.gif["向下指向藍色箭頭"]預設原則旁的、然後選取您要使用的現有原則。



| 建立新的快照原則  a| 
.. 選擇image:icon_add.gif["藍色加號、接著加上「 ADD 」字樣"]；然後輸入新的原則名稱。
.. 選取原則範圍。
.. 在 * 排程 * 下image:icon_add.gif["藍色加號、接著加上「 ADD 」字樣"]、選擇。
.. 選擇出現在 * 排程名稱 * 下的名稱；
+
然後選擇。image:icon_dropdown_arrow.gif["藍色箭頭指向向下方向"]

.. 選取原則排程。
.. 在 * 最大快照數 * 下、輸入您要保留一致性群組的最大快照數。
.. 或者、在 * SnapMirror label* 下輸入 SnapMirror 標籤。
.. 選擇*保存*。


|===
. 選擇*編輯*。


.下一步
現在您的資料已受到快照保護、您應該link:../secure-data/encrypt-data-at-rest.html["設定快照複寫"]將一致性群組複製到地理位置遠端位置、以便進行備份和災難恢復。



== 從一致性群組移除快照資料保護

當您從一致性群組移除快照資料保護時、一致性群組中所有儲存單元的快照都會停用。

.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 將游標移到您要停止保護的一致性群組上。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 編輯 * 。
. 在 * 本機保護 * 下、取消選取排程快照。
. 選擇*編輯*。


.結果
不會為一致性群組中的任何儲存單元擷取快照。



== 將儲存單元新增至一致性群組

將儲存單元新增至一致性群組、以擴充由一致性群組管理的儲存容量。

您可以將現有的儲存單元新增至一致性群組、或是建立新的儲存單元以新增至一致性群組。

[role="tabbed-block"]
====
.新增現有的儲存單元
--
.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 將游標移至您要擴充的一致性群組上方。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 展開 * 。
. 選擇 * 使用現有的儲存單元 * 。
. 選取要新增至一致性群組的儲存單元、然後選取 * 展開 * 。


--
.新增儲存單元
--
.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 將游標移至您要擴充的一致性群組上方。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 展開 * 。
. 選擇 * 使用新的儲存單元 * 。
. 輸入您要建立的單位數量、以及每單位的容量。
+
如果您建立一個以上的單元、則每個單元都會建立相同的容量和相同的主機作業系統。若要為每個單位指派不同的容量、請選取 * 新增不同容量 * 、為每個單位指派不同的容量。

. 選取 * 展開 * 。


.下一步
建立新的儲存單元之後link:../manage-data/provision-san-storage.html#add-host-initiators["新增主機啟動器"]、您應該和link:../manage-data/provision-san-storage.html#map-the-storage-unit-to-a-host["將新建立的儲存單元對應至主機"]。新增主機啟動器可讓主機符合存取儲存單元和執行資料作業的資格。將儲存單元對應至主機可讓儲存單元開始將資料提供給對應的主機。

--
====
.接下來呢？
一致性群組的現有快照不會包含新增的儲存單元。link:create-snapshots.html#step-2-create-a-snapshot["建立即時快照"]在自動建立下一個排程快照之前、您應該是一致性群組的成員、以保護新增的儲存單元。



== 從一致性群組中移除儲存單元

如果您想要刪除儲存單元、想要將其視為不同一致性群組的一部分進行管理、或是不再需要保護其所包含的資料、則應該從一致性群組中移除儲存單元。從一致性群組移除儲存單元會中斷儲存單元與一致性群組之間的關係、但不會刪除儲存單元。

.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 按兩下您要從中移除儲存單元的一致性群組。
. 在 * 總覽 * 區段的 * 儲存單元 * 下、選取您要移除的儲存單元、然後選取 * 從一致性群組移除 * 。


.結果
儲存單元不再是一致性群組的成員。

.下一步
如果您需要繼續保護儲存單元的資料、請將儲存單元新增至另一個一致性群組。



== 將現有的一致性群組轉換成父一致性群組

儲存單元不能直接與父一致性群組相關聯。如果您將現有的一致性群組轉換為父群組，則會建立新的子一致性群組，並將屬於轉換一致性群組的儲存單元移至新的子一致性群組。

.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 將游標移到您要轉換成父一致性群組的一致性群組上。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 提升至父一致性群組 * 。
. 輸入父一致性群組的名稱或接受預設名稱，然後選取一致性群組元件類型。
. 選擇 * 促銷 * 。


.接下來呢？
您可以在父一致性群組下建立其他子一致性群組。您也可以link:../secure-data/encrypt-data-at-rest.html["設定快照複寫"]將父一致性群組複製到地理位置遠端位置，以進行備份和災難恢復。



== 建立子一致性群組

建立子一致性群組可讓您將個別的快照原則套用至每個子層級，同時將複寫原則套用至父層級的所有子一致性群組。

您可以從新的或現有的一致性群組建立子一致性群組。

[role="tabbed-block"]
====
.來自新的一致性群組
--
.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 將游標移至您要新增子一致性群組的父一致性群組。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 新增子一致性群組 * 。
. 輸入子一致性群組的名稱或接受預設名稱，然後選取一致性群組元件類型。
. 選取以將現有儲存單元新增至子一致性群組，或建立新的儲存單元。
+
如果您建立新的儲存單元，請輸入您要建立的單元數和每個單元的容量，然後輸入主機資訊。

+
如果您建立多個儲存單元，則每個單元都會建立相同的容量和相同的主機作業系統。若要指派不同容量給每個單位，請選取 * 新增不同容量 * 。

. 選取*「Add*」。


--
.來自現有一致性群組
--
.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 選取您要建立子一致性群組的現有一致性群組。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 移至不同一致性群組 * 下。
+
如果您想將一致性群組當作另一個一致性群組的子群組使用，則必須先將其與現有父一致性群組分離，才能將其移至新的父一致性群組。

. 輸入子一致性群組的新名稱或接受預設名稱，然後選取一致性群組元件類型。
. 選取您想要建立父一致性群組的現有一致性群組，或選取以建立新的父一致性群組。
+
如果您選擇建立新的父一致性群組，請輸入父一致性群組的名稱或接受預設名稱，然後選取一致性應用程式元件類型。

. 選取 * 移動 * 。


--
====
.下一步
建立子一致性群組之後，您可以link:policies-schedules.html#apply-a-snapshot-policy-to-a-consistency-group["套用個別的快照保護原則"]移至每個子一致性群組。您也可以link:snapshot-replication.html["設定複寫原則"]在父一致性群組上，將所有子一致性群組的快照複寫到單一單位的遠端叢集。



== 將父一致性群組降級為單一一致性群組

當您將父一致性群組降級為單一一致性群組時，相關子一致性群組的儲存單元會新增至父一致性群組。子一致性群組會被刪除，然後將父一致性群組管理為單一一致性群組。

.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 將游標暫留在您要降級的父一致性群組上。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 降級至單一一致性群組 * 。
. 選擇 * 降級 *


.接下來呢？
link:policies-schedules.html#apply-a-snapshot-policy-to-a-consistency-group["新增快照原則"]移至降級一致性群組，以保護先前由子一致性群組管理的儲存單元。



== 將子一致性群組與父一致性群組分離

當您將子一致性群組與父一致性群組分離時，子一致性群組會從父一致性群組中移除，並以單一一致性群組來管理。套用至父項的複寫原則不再套用至分離的子項一致性群組。

.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 選取父一致性群組。
. 選取您要分離的子一致性群組。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 從父 * 分離。
. 為您要分離的一致性群組輸入新名稱，或接受預設名稱，然後選取一致性群組應用程式類型。
. 選取 * 分離 * 。


.接下來呢？
link:snapshot-replication.html["設定複寫原則"]將分離子一致性群組的快照複寫到遠端叢集，做為單一一致性群組。



== 刪除一致性群組

如果不再需要將一致性群組的成員當作單一單位來管理、您可以刪除一致性群組。刪除一致性群組之後、群組中先前的儲存單元仍會在叢集上保持作用中。

.開始之前
如果您要刪除的一致性群組位於複寫關係中、則必須先中斷關聯、然後再刪除一致性群組。刪除複寫一致性群組之後、一致性群組中的儲存單元會在叢集上保持作用中、而其複寫複本則會保留在遠端叢集上。

.步驟
. 在 System Manager 中、選取 * 保護 > 一致性群組 * 。
. 將游標移至您要刪除的一致性群組上方。
. 選擇image:icon_kabob.gif["三個垂直藍點"]；然後選擇 * 刪除 * 。
. 接受警告、然後選取 * 刪除 * 。


.接下來呢？
刪除一致性群組之後、先前位於一致性群組中的儲存單元將不再受到快照保護。請考慮將這些儲存單元新增至另一個一致性群組、以防止資料遺失。
